# app/prompts/analysis_prompt.py

def get_analysis_prompt(transcript):
    """
    Возвращает промпт для анализа звонка с новой структурой оценки
    
    Args:
        transcript (str): Текст транскрипции звонка
        
    Returns:
        str: Готовый промпт для отправки в LLM
    """
    return f"""
Проанализируй следующую транскрипцию звонка продажника с клиентом и дай подробный анализ по новой структуре оценки.

# Структура оценки (всего 0-10 баллов):

## 1. Этапы продажи (25% от общей оценки):
- Установление контакта и представление (0-5)
- Выявление потребностей клиента (0-5)
- Презентация решения/продукта (0-5)
- Работа с возражениями (0-5)
- Закрытие сделки (0-5)

## 2. Коммуникативные навыки (25% от общей оценки):
- Активное слушание (0-5)
- Четкость изложения информации (0-5)
- Эмпатия и построение раппорта (0-5)
- Управление темпом разговора (0-5)
- Невербальные сигналы/тон голоса (0-5)

## 3. Технические компетенции (20% от общей оценки):
- Знание продукта (0-10)
- Знание конкурентов и рынка (0-5)
- Правильное использование инструментов продаж (0-5)

## 4. Тактические навыки (20% от общей оценки):
- Применение техник продаж (0-5)
- Определение типа клиента и адаптация подхода (0-5)
- Преодоление барьеров и обработка возражений (0-5)
- Повышение ценности предложения (0-5)

## 5. Результативность (10% от общей оценки):
- Достижение целей звонка (0-10)

Также выдели:
- 3-5 конкретных сильных сторон продажника
- 3-5 конкретных областей для улучшения
- 3-5 рекомендаций для обучения
- 3-5 лучших моментов в разговоре с комментариями
- 3-5 моментов, требующих улучшения, с комментариями

Верни результат строго в формате JSON:
{{
    "sales_stages": {{
        "items": {{
            "contact_establishment": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }},
            "needs_identification": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }},
            "solution_presentation": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }},
            "objection_handling": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }},
            "closing": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }}
        }},
        "weighted_score": 0-10
    }},
    "communication": {{
        "items": {{
            "active_listening": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }},
            "clarity": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }},
            "rapport_building": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }},
            "conversation_pacing": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }},
            "non_verbal": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }}
        }},
        "weighted_score": 0-10
    }},
    "technical": {{
        "items": {{
            "product_knowledge": {{
                "score": 0-10,
                "comment": "Комментарий к оценке"
            }},
            "market_knowledge": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }},
            "crm_usage": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }}
        }},
        "weighted_score": 0-10
    }},
    "tactical": {{
        "items": {{
            "sales_techniques": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }},
            "client_adaptation": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }},
            "overcoming_barriers": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }},
            "value_proposition": {{
                "score": 0-5,
                "comment": "Комментарий к оценке"
            }}
        }},
        "weighted_score": 0-10
    }},
    "results": {{
        "items": {{
            "call_goals_achievement": {{
                "score": 0-10,
                "comment": "Комментарий к оценке"
            }}
        }},
        "weighted_score": 0-10
    }},
    "overall": 0-10,
    "strengths": [
        "Сильная сторона 1",
        "Сильная сторона 2"
    ],
    "areas_for_improvement": [
        "Область для улучшения 1",
        "Область для улучшения 2"
    ],
    "training_recommendations": [
        "Рекомендация 1",
        "Рекомендация 2"
    ],
    "best_moments": [
        {{
            "text": "Цитата из разговора",
            "comment": "Почему это хороший момент"
        }}
    ],
    "worst_moments": [
        {{
            "text": "Цитата из разговора",
            "comment": "Почему это проблемный момент"
        }}
    ]
}}

Вот транскрипция звонка:
{transcript}
"""