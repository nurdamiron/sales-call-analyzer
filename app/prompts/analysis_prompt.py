# app/prompts/analysis_prompt.py

def get_analysis_prompt(transcript):
    """
    Возвращает промпт для анализа звонка с новой структурой оценки
    
    Args:
        transcript (str): Текст транскрипции звонка
        
    Returns:
        str: Готовый промпт для отправки в LLM
    """
    return f"""
Проанализируй следующую транскрипцию звонка продажника с клиентом и дай подробный анализ.
Оцени по шкале от 0 до 10 следующие аспекты:
1. Соблюдение скрипта продаж (script_adherence)
2. Активное слушание (active_listening)
3. Работа с возражениями (objection_handling)
4. Применение техник продаж (sales_techniques)
5. Этика общения (communication_ethics)

ВАЖНО: Если клиент не выдвигал возражений во время звонка, то для критерия "objection_handling" 
поставь null вместо числовой оценки и укажи в комментарии "Клиент не предъявлял возражений". 
Этот критерий не должен учитываться в общей оценке.

Также выдели:
- Анализ по этапам разговора (greeting, needs_identification, presentation, objection_handling, closing)
- 3-5 лучших моментов в разговоре с комментариями
- 3-5 моментов, требующих улучшения, с комментариями
- 3-5 конкретных рекомендаций для продажника

Верни результат строго в формате JSON:
{{
    "analysis": {{
        "greeting": "Анализ приветствия",
        "needs_identification": "Анализ выявления потребностей",
        "presentation": "Анализ презентации продукта",
        "objection_handling": "Анализ работы с возражениями",
        "closing": "Анализ закрытия сделки"
    }},
    "score": {{
        "script_adherence": {{
            "score": 0-10,
            "comment": "Комментарий к оценке"
        }},
        "active_listening": {{
            "score": 0-10,
            "comment": "Комментарий к оценке"
        }},
        "objection_handling": {{
            "score": 0-10 или null,
            "comment": "Комментарий к оценке"
        }},
        "sales_techniques": {{
            "score": 0-10,
            "comment": "Комментарий к оценке"
        }},
        "communication_ethics": {{
            "score": 0-10,
            "comment": "Комментарий к оценке"
        }}
    }},
    "best_moments": [
        {{
            "text": "Цитата из разговора",
            "comment": "Почему это хороший момент"
        }}
    ],
    "worst_moments": [
        {{
            "text": "Цитата из разговора",
            "comment": "Почему это проблемный момент"
        }}
    ],
    "recommendations": [
        "Рекомендация 1",
        "Рекомендация 2"
    ]
}}

Вот транскрипция звонка:
{transcript}
"""